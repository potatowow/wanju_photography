 $(function () { 


    // comic
    var _total = $("#comic-scene .section").length;
    var _base = 800;
    var _height = _base * _total;

    $("#comic-height").css("height", _height)

    $("#comic-scene .section").each(function (i) {
      $(this).css({
        transform: 'translate3d(0px, 0px, '+ _base * -1 * i +'px)'
      })
    })

    $(window).on("scroll", function (){

      var _scrolltop = $(this).scrollTop()

      $("#comic-scene").css({
        transform: 'translate3d(0px, 0px, '+ _scrolltop +'px)'
      })
    })

    $(".firstScene span").on("click", function (){
      $.scrollTo(300, {duration: 1000}); 
    })

    // check layer level
    window.requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;
    window.cancelAnimationFrame = window.cancelAnimationFrame || window.mozCancelAnimationFrame;

    function checkLevel() {
      var _t = $(window).scrollTop()
      var _level = Math.floor(_t / _base)

      if (_t < 300) {
        $(".firstScene").css({
          opacity: 1 - (_t * 0.01)
        })
      }else{
        $(".firstScene").show()
      }

      $("#comic-scene .section").hide()

      if (_level == 0) {
        $("#comic-scene .section").eq(_level).show()
        $("#comic-scene .section").eq(_level + 1).show()
      }else{
        $("#comic-scene .section").eq(_level - 1).show()
        $("#comic-scene .section").eq(_level).show()
        $("#comic-scene .section").eq(_level + 1).show()

      }

      requestAnimationFrame(checkLevel);
    }

    checkLevel();


  })